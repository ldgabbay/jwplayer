<!doctype html>
<html>
<head>
<title>MP4 Video Encoding</title>
<style>
    body { padding: 50px 100px; width: 700px; font: 13px/20px Arial; background: #FFF; }
    a, h1, h2 { color: #369; }
    h1 { font-size: 32px; }
    h2 { margin-top: 50px; }
    h3 { margin-top: 25px; }
    img { display: block; margin: 0 10px; }
    pre { font-size: 12px; background: #E5F3C8; padding:5px 10px; border: 1px solid #D3EAA4; }
    dt { padding-left: 20px; font-weight: bold; }
    dd { color: #333; font-style: italic; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    tr { border-bottom: 1px solid #CCC; } 
    tr:nth-child(even) { background: #EEE; }
    td,th { padding: 5px; font-size: 12px; text-align: left; }

</style>
</head><body>

<h1>MP4 Video Encoding</h1>

<p>This document provides an introduction to encoding web optimized MP4 videos. It lists the format, dimensions and bitrates  required for high-quality playback across all major browsers and devices. It does not cover specialized topics such as adaptive streaming or advanced x264 parameters.</p>

<h2>Formats</h2>

<p>As we find with images (JPG, PNG, GIF) and sounds (WAV, MP3, AAC), videos are available in many different formats today: MP4, FLV, AVI, WebM, MOV, et cetera. Different from images and sound formats, video formats consists of not one but three building blocks. Thus, when we use the term <em>format</em>, we are referring to a combination of:</p>

<ol>
<li>The <a href="http://en.wikipedia.org/wiki/Container_format_(digital)">container format</a> that wraps the audio and video codecs, but doesn't contain the raw data itself.</li>
<li>The <a href="http://en.wikipedia.org/wiki/Video_codec">video codec</a> which contains the actual, encoded video frames.</li>
<li>The <a href="http://en.wikipedia.org/wiki/Audio_codec">audio codec</a> which contains the actual, encoded audio samples.</li>
</ol>

<p>The better the video and audio codecs are, the smaller and easier to process the resulting video file is, without sacrificing quality. Here is a short list of today's common video formats:</p>

<ul>
<li>The <a href="http://en.wikipedia.org/wiki/MP4">MP4</a> format, with <a href="http://en.wikipedia.org/wiki/H264">H264</a> video and <a href="http://en.wikipedia.org/wiki/AAC">AAC</a> audio.</li>
<li>The <a href="http://en.wikipedia.org/wiki/WebM">WebM</a> format, with <a href="http://en.wikipedia.org/wiki/VP8">VP8</a> video and <a href="http://en.wikipedia.org/wiki/Vorbis">Vorbis</a> audio.</li>
<li>The <a href="http://en.wikipedia.org/wiki/FLV">FLV</a> format, with <a href="http://en.wikipedia.org/wiki/H263">H263</a> video and <a href="http://en.wikipedia.org/wiki/MP3">MP3</a> audio.</li>
</ul>

<p>All three formats are of good quality, with MP4 generally seen as the best and FLV as outdated. Where these formats differ greatly are with the browsers and devices that support their playback. Our <a href="media.html">Supported Media Formats</a> guide lists all details, but in sum:</p>

<ul>
<li><strong>MP4</strong> works on devices, on browsers in Flash and on half the browsers in HTML5.</li>
<li><strong>WebM</strong> only works on half the browsers in HTML5.</li>
<li><strong>FLV</strong> only works on browsers in Flash.</li>
</ul>

<p>Since JW Player supports both Flash and HTML5 on desktops, MP4 is the single format that can be used to serve all browsers (Chrome, IE, Firefox, etc) and devices (iOS, Android, etc). For the remainder of this guide, we'll therefore focus on MP4.</p>



<h2>Dimensions</h2>

<p>The dimensions of a compressed video largely define how good it looks. Here is an overview of the most important ones for online video (2:1 scale):</p>

<p><img src="assets/encoding-video-dimensions.png" alt="online video dimensions comparison" /></p>

<p>Though bigger is often better, a tradeoff is made. Larger videos are hard to decode; many mobile phones (or old desktops) will not be able to decode videos above SD quality. If you choose dimensions of 640x360 or lower, your compressed video will always work on:</p>

<ul>
<li>All desktop computers, using Flash or HTML5.</li>
<li>All iPad, iPhone and iPod Touch models.</li>
<li>All Android 2+ phones and tablets.</li>
<li>Nearly all other recent phones, tablets and set-tops.</li>
</ul>  

<p>If your source video is not using the default 16:9 aspect ratio, we suggest you maintain the height and shrink the width. For example, a 4:3 video then becomes 480x360 pixels, which will still work on all devices (640x480 is too big for various phones).</p>

<p>If your source video is in HD, you can also build a <strong>720p</strong> version of your video. This is nice for fullscreen desktop playback and tablets (the iPad). Do not embed solely that version, since many devices may not be able to play it. See <a href="playlists.html">Working with Playlists</a> for embedding JW Player with a quality selection menu, so users can pick the 360p or 720p version.</p>


<h2>Bitrates</h2>

<p>Another important compression setting is the bitrate of a video: the amount of bandwidth it uses per second. Videos should download fast enough to be played back in real time, otherwise users see constant stuttering. Luckily, broadband internet is common <a href="http://www.akamai.com/stateoftheinternet/">in many countries today</a>. Its speed of at least 2000 kbps (<em>kilobits per second</em>) is already sufficient for 720p HD video.</p>

<p>For mobile internet, the speed depends upon your reception and network type. With a good reception, the older <a href="http://en.wikipedia.org/wiki/2G">2G</a> networks have an average speed of 150 kbps, today's typical <a href="http://en.wikipedia.org/wiki/3G">3G</a> networks average 800 kbps and the up-and-coming <a href="http://en.wikipedia.org/wiki/3G">4G</a> networks now do about 2000 kbps.</li>
</ul>

<p>For MP4 videos to look good (i.e. no visible artifacts), here are some target video bitrates. Don't use them as hard rules, but do a few tests with your video and use the smallest bitrate that looks good:</p>

<table>
    <tr><th>Dimensions</th><th>Interviews / screencasts</th><th>Shows / presentations</th><th>Trailers / music / sports</th></tr>
    <tr><td>320x180 pixels</td><td>150 kbps</td><td>300 kbps</td><td>450 kbps</td></tr>
    <tr><td>480x270 pixels</td><td>200 kbps</td><td>400 kbps</td><td>600 kbps</td></tr>
    <tr><td>640x360 pixels</td><td>400 kbps</td><td>700 kbps</td><td>1000 kbps</td></tr>
    <tr><td>960x540 pixels</td><td>700 kbps</td><td>1100 kbps</td><td>1600 kbps</td></tr>
    <tr><td>1280x720 pixels</td><td>1000 kbps</td><td>1500 kbps</td><td>2200 kbps</td></tr>
</table>

<p>Of course the audio has to be compressed to a sane bitrate too. For AAC, a value of 96 kbps should suit all purposes. For a size of 480x270 pixels, the average trailer/music/sports video will then use 700 kbps overall. That still fits the average 3G connection.</p>


<h2>Tools</h2>

<p>If you don't yet have a tool for transcoding your videos, you should download <a href="http://handbrake.fr/">HandBrake</a>. It is a free desktop tool for Linux, MAC and Windows that contains many settings beyond the scope of this guide. Creating the 480x270 video described above is easy though:</p>

<p><img src="assets/encoding-handbrake-settings.png" alt="important HandBrake compression settings" /></p>

<ol>
<li>Select your source video using the <em>Source</em> button.</li>
<li>Set the destination of the encoded video using the <em>File</em> box.</li>
<li>From the <em>Presets</em> drawer, select the <strong>iPhone &amp; iPod Touch</strong> preset.</li>
<li>In the <em>Quality</em> field, set a constant quality of about <strong>20</strong> (good) to <strong>25</strong> (decent). This feature automatically sets a good video quality, resulting in the bitrates from above table.</li>
<li>Check the small <em>Web optimized</em> box. It ensures the metadata of your video is written at the start, so Flash can swiftly see its duration and dimensions.</li>
<li>Now click the <em>Start</em> button and see your encode getting built!</li>
</ol>

<p>Repeat these settings for the 720p HD compression, but use the <strong>Regular &raquo; Normal</strong> preset instead of the iPhone/iPod one. If your source video is larger than 1280x720 (or you want 640x360), you can scale the output by clicking the <em>Picture Settings</em> button.</p>

<p>Note that many other tools and services are available for encoding your files. An easy-to-use hosted service is our own Online Video Platform <a href="http://www.longtailvideo.com/bits-on-the-run/">Bits on the Run</a>. It is free for low-volume usage and allows you to encode videos in MP4, WebM and FLV format. <a href="http://www.longtailvideo.com/support/bits-on-the-run/24279/understanding-our-transcoding">See this guide for more details</a>.</p>

<p>If you want more control over the encoding process and don't mind investing some money, you can look into a  desktop tool like <a href="http://www.sorensonmedia.com/video-encoding/">Sorenson Squeeze</a> or an online service like <a href="http://zencoder.com/">Zencoder.com</a>. Both offer many output formats and many settings for tweaking the quality and filesize.</p>

</body>
</html>