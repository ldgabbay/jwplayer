<!doctype html>
<html>
<head>
<title>Building JavaScript Plugins</title>
<style>
    body { padding: 50px 100px; width: 700px; font: 13px/20px Arial; background: #FFF; }
    a, h1, h2 { color: #369; }
    h1 { font-size: 32px; }
    h2 { margin-top: 50px; }
    h3 { margin-top: 25px; }
    img { display: block; margin: 0 10px; }
    pre { font-size: 12px; background: #E5F3C8; padding:5px 10px; border: 1px solid #D3EAA4; }
    dt { padding-left: 20px; font-weight: bold; }
    dd { color: #333; font-style: italic; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    tr { border-bottom: 1px solid #CCC; } 
    tr:nth-child(even) { background: #EEE; }
    td,th { padding: 5px; font-size: 12px; text-align: left; vertical-align: top; }
</style>
</head><body>



<h1>Building JavaScript Plugins</h1>

<p>This page explains the details of building JavaScript plugins for JW Player. See <a href="plugins.html">About JW Player Plugins</a> for a general overview and info on embedding plugins.</p>



<h2>Getting Started</h2>


<p>Building JavaScript plugins for the JW Player requires a fairly minimal toolset. Specifically, you'll need:</p>

<ul>
<li>The <a href="http://developer.longtailvideo.com/trac/browser/sdks">JW6 plugin SDK</a>, which contains example plugins and basic test pages.</li>
<li>A text editor (pretty much anything except for Word will do) and a web browser (for testing your plugins).</li>
</ul>

<p>We also recommend that you set up a local web server for testing. Tools like <a  href="http://www.apachefriends.org/">XAMPP for Windows</a> and <a  href="http://www.mamp.info/">MAMP for Mac</a> make this incredibly quick.</p>

<h3>Hello World</h3>

<p>Here is a very basic example plugin, which displays some text on top of JW Player:</p>

<pre>
// Closure to prevent this code from conflicting with other scripts
(function(jwplayer){

  // The initialization function, called on player setup.
  var template = function(player, config, div) {

    // When the player is ready, let's add some text.
    player.onReady(setup); 
    function setup(evt) {
        div.style.color = "red";
        div.innerHTML = "Hello World!";
    };
    
    // This function is required. It can be used to resize the div.
    this.resize = function(width, height) {};

  };

  // This line registers above code as a plugin called "helloworld".
  jwplayer().registerPlugin('helloworld', template);

})(jwplayer);
</pre>

<p>To see this plugin in action, simply store its code as a .js file on your webserver and load it into JW Player as described in <a href="plugins">About JW Player Plugins</a>.</p>



<h2>Plugin Features</h2>

<p>First and foremost, a JavaScript plugin is a script like any other. It uses the regular <a href="scripting.html">JW Player JavaScript API</a> to interact with JW Player and has no special or additional API calls at its disposal.</p>

<h3 id="Registering">Registering</h3>
<p>
When a JavaScript plugin file is inserted into the DOM, it is executed by the browser. Part of every plugin is the  <em>jwplayer().registerPlugin()</em> call (see our example above). As the name says, it registers the plugin with the JW Player, making its code available to every player on the page:
</p>
<pre>jwplayer().registerPlugin(id, jsPlugin);
</pre><ul><li><strong>id</strong> {String}: The id of the plugin.
</li><li><strong>jsPlugin</strong> {Function}: The plugin javascript function.
</li></ul><p>
The <em>registerPlugin()</em> method has an interesting feature: it can be used to load an ActionScript (SWF) plugin, in addition to the regular plugin JavaScript. With this feature, you can write <em>hybrid</em> plugins. These plugins can leverage the power and performance of Flash, but work in HTML5 mode too:
</p>
<pre>jwplayer().registerPlugin(id, jsPlugin, swfURL);
</pre><ul><li><strong>id</strong> {String}: The id of the plugin.
</li><li><strong>jsPlugin</strong> {Function}: The plugin javascript function.
</li><li><strong>swfURL</strong> {String}: The URL of the Flash plugin to load.  Please note, the <em>id</em> property set in the Flash plugin must match the file name of the plugin SWF.
</li></ul><p>
In Flash mode, both the JavaScript and the ActionScript plugin are instantiated. In HTML5 mode, only the JavaScript plugin is instantiated. In your plugin, you can detect which mode is active by doing a <em>player.getRenderingMode()</em> API call.
</p>


<p>
As you could see in the example, a plugin needs two blocks of code: the code used for loading/registering the plugin, and the plugin code itself. Let's now take a look at the plugin itself.
</p>
<h3 id="TheConstructor">The Constructor</h3>
<p>
The constructor (called <em>template</em> in the example) is the entry point for a plugin. It is called by every player on the page that wants to use this plugin.  The constructor accepts three arguments: <strong>player</strong>, <strong>config</strong> and <strong>div</strong>:
</p>
<ul><li><strong>player</strong> {Object}: The player API with all actions, getters, and event listeners available. Use this variable to interact with the player. See the <a href='http://www.longtailvideo.com/support/jw-player/jw-player-for-flash-v5/12540/javascript-api-reference'>JavaScript API Reference</a> for a full listing.
</li><li><strong>config</strong> {Object}: The specified plugin's configuration from jwplayer().setup(â€¦). In the <strong>Hello World</strong> example above, this object contains one entry, named <em>text</em>. Use this mechanism to allow users of your plugin to configure it.
</li><li><strong>div</strong> {DOMElement}: A &lt;div&gt; in the DOM that sits on top of the player's display area. If a plugin wants to show visual assets (e.g. banners, forms), they should be inserted in this &lt;div&gt;. In its basic form (see example above), you can simply set the <strong>div.innerHTML</strong> attribute.
</li></ul><h3 id="TheresizeMethod">The resize() Method</h3>
<p>
In addition to the arguments that are passed into the JS, there is one required method for all plugins: <em>this.resize()</em>. It is automatically called by the player when it resizes, sending the new width and height of the video display (<strong>not</strong> the display + controlbar!) as values.
</p>
<p>
The <strong>this.resize</strong> method is also called on startup, when the player does an initial resize. Therefore, it's good practice to have the setup of your visuals triggered by this resize() call. For example, here's an example of a plugin's resize method that keeps the plugin centered in the player:
</p>
<pre>this.resize = function(width, height) {
    div.style.position = 'absolute';
    div.style.height = '60px';
    div.style.width = '60px';
    div.style.left = Math.round(width/2-30)+'px';
    div.style.top = Math.round(height/2-30)+'px';
};
</pre>



<h2>Test and Release</h2>

<p>Since plugins are simply JavaScript, they are best tested with the debugging tools all modern browsers provide. Tracing some data to the browser console, for example, can be done with a call to console.log:</p>

<pre>
console.log("This text will appear in your browser console");
</pre>

<p>When you're happy with the functionalities of a plugin, it's time to wrap it up for release. There's a few things you should do to optimize the loading of the plugin.</p>

<h3>Minification</h3>

<p>We highly recommend minifying your JS using a tool like the <a  href="http://developer.yahoo.com/yui/compressor/">YUI Compressor</a> or the <a  href="http://code.google.com/closure/">Google Closure Compiler</a>. This will reduce the size of your plugin, without impacting performance.</p>

<h3>Base64 Encoding</h3>

<p>If you're using images in your plugin, you can base64 encode and then embed them into the javascript. This will:</p>

<ul>
<li>Speed up loading, because only one resource has to get loaded.</li>
<li>Remove all issues around filepaths to the images, making the plugin easier to deploy.</li>
</ul>

<p>Many tools exist, both online and offline, to base64 encode an image. <a  href="http://www.askapache.com/online-tools/base64-image-converter/">>Here is an example page</a> where you can simply upload your image and copy/paste the resulting Base64 hash.</p>



</body>
</html>