<!doctype html>
<html>
<head>
<title>Building Flash Plugins</title>
<style>
    body { padding: 50px 100px; width: 700px; font: 13px/20px Arial; background: #FFF; }
    a, h1, h2 { color: #369; }
    h1 { font-size: 32px; }
    h2 { margin-top: 50px; }
    h3 { margin-top: 25px; }
    img { display: block; margin: 0 10px; }
    pre { font-size: 12px; background: #E5F3C8; padding:5px 10px; border: 1px solid #D3EAA4; }
    dt { padding-left: 20px; font-weight: bold; }
    dd { color: #333; font-style: italic; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    tr { border-bottom: 1px solid #CCC; } 
    tr:nth-child(even) { background: #EEE; }
    td,th { padding: 5px; font-size: 12px; text-align: left; vertical-align: top; }
</style>
</head><body>



<h1>Building Flash Plugins</h1>

<p>This page explains the details of building Flash plugins for JW Player. See <a href="plugins.html">About JW Player Plugins</a> for a general overview and info on embedding plugins.</p>



<h2>Getting started</h2>

<p>Before starting development, you need the following free tools:</p>

<ul>
<li>The <a href="http://www.adobe.com/products/flex">Flex SDK</a> from Adobe. It contains an ActionScript compiler and definitions for all classes that are built into the Flash plugin.</li>
<li>Our <a href="http://developer.longtailvideo.com/trac/browser/sdks/">JW6 plugin SDK</a>. It contains a few example plugins, as well as the <i>jwplayer.swc</i> library that contains all JW Player class definitions.</li>
</ul>

<p>Each plugin should implement the JW Player <strong>IPlugin</strong> interface, which defines an <em>initPlugin()</em> function, a <em>resize()</em> function and an <em>id()</em> getter. Second, plugins need to extend the <strong>Sprite</strong> or <strong>Movieclip</strong> class.</p>

<h3>Hello World</h3>

<p>The most basic plugin to write would look something like this:</p>

<pre>
package {
  import flash.display.Sprite;
  import flash.text.TextField;
  import com.longtailvideo.jwplayer.player.*;
  import com.longtailvideo.jwplayer.plugins.*;

  public class HelloWorld extends Sprite implements IPlugin {

    /** Configuration options of the plugin. **/
    private var _config:PluginConfig;
    /** Reference to the JW Player API. **/
    private var _player:IPlayer;
    /** Text field to print into. **/
    private var _field:TextField;

    /** This function is automatically called upon load. **/
    public function initPlugin(player:IPlayer, config:PluginConfig):void {
      _player = player;
      _config = config;
      _field = new TextField();
      _field.text = "Hello World!";
      addChild(_field);
    }

    /** This should be the lowercase name of the plugin SWF file. **/
    public function get id():String {
      return "helloworld";
    }

    /** This is called when the player resizes. **/
    public function resize(width:Number, height:Number):void {
      _field.x = width/2 - 50;
      _field.y = height/2 - 50;
    }

  }
}
</pre>

<p>The JW6 plugin SDK contains a build script (<em>build.sh</em> for Mac OS X and Linux, <em>build.bat</em> for Windows) that can be used to compile this code into a plugin using Flex SDK's mxmlc compiler.</p>


<h2>Player Interaction</h2>

<p>The <a href="http://developer.longtailvideo.com/trac/browser/trunk/fl5/src/com/longtailvideo/jwplayer/player/IPlayer.as">IPlayer interface</a> is the bridge by which the player and your plugin communicate. The following handful of properties and functions give you full access to the player:
</p>
<ol><li>Access the <a href="http://developer.longtailvideo.com/trac/browser/trunk/fl5/src/com/longtailvideo/jwplayer/player/PlayerConfig.as">PlayerConfig object</a>, containing all player configuration parameters, through <strong>player.config</strong>.
</li><li>Access the <a href="http://developer.longtailvideo.com/trac/browser/trunk/fl5/src/com/longtailvideo/jwplayer/model/Playlist.as">Playlist object</a> of the player through <strong>player.playlist</strong>.
</li><li>Send directives to the player with by calling the <a href="http://www.longtailvideo.com/support/jw-player/jw-player-for-flash-v5/17677/flash-plugin-api-reference#Playercommands">public player commands</a>.
</li><li>Subscribe to <a href="http://developer.longtailvideo.com/trac/wiki/Player5Events">player events</a> by calling <strong>player.addEventListener()</strong>.
</li><li>Add a <a href="http://www.longtailvideo.com/support/jw-player/jw-player-for-flash-v5/17677/flash-plugin-api-reference#PlayerControls">dock or controlbar button</a>.
</li><li>Request the configuration of another plugin through <strong>player.config.pluginConfig(pluginID)</strong>.  The configuration properties of the core user interface controls (<strong>controlbar</strong>, <strong>playlist</strong>, <strong>dock</strong> and <strong>display</strong>) are also available through this interface (e.g. <strong>player.config.pluginConfig('controlbar')</strong>).
</li></ol><p>
<strong>Note:</strong> Due to a Flash player embedding bug having to do with passing flashvars whose names contain both "." characters and upper and lower-case letters, the player converts all flashvar names to lower case.  It is highly encouraged to restrict configuration names to all-lowercase characters.
</p>
<p>
Again note that a complete overview of all available calls can be found on the <a href="http://developer.longtailvideo.com/trac/wiki/Player5Api">API reference page</a>. 
</p>
<p>
Here's a plugin code snippet that listens to changes in the playback position:
</p>
<pre class="prettyprint">public function initPlugin(player:IPlayer, config:PluginConfig):void  {
    player.addEventListener(MediaEvent.JWPLAYER_MEDIA_TIME, timeHandler);
}

private function timeHandler(evt:MediaEvent):void {
    Logger.log("the new position is: "+evt.position);
}
</pre><p>
Here's another snippet that loads a specific video once the user clicks a button:
</p>
<pre class="prettyprint">private var button:Sprite;
private var video:String = "http://www.mysite.com/video/myVideo.flv";
private var player:IPlayer;

public function initializePlugin(ply:IPlayer, conf:PluginConfig) {
    player = ply;
    button.addEventListener(MouseEvent.CLICK,loadVideo);
}

private function loadVideo(evt:MouseEvent):void {
    player.load(video);
}
</pre><p>
This last snippet implements the resize method so the plugin can be rescaled after a resize:
</p>
<pre class="prettyprint">private var config:PluginConfig;
private var rectangle:MovieClip;
private var player:IPlayer;

public function initializePlugin(ply:IPlayer, cfg:PluginConfig):void { 
    player = ply;
    config = cfg;
}

public function resize(width:Number, height:Number):void {
    // A plugin config contains the x,y,width,height position of the plugin and is automatically updated.
    rectangle.x = config['x'];
    rectangle.y = config['y'];
    rectangle.width = config['width'];
    rectangle.height = config['height'];
};
</pre><p>
We also have several <a href="http://developer.longtailvideo.com/trac/browser/plugins">open-source plugins</a> which you can use to help you get started. 
</p>
<h2 id="Loadingdata">Loading data</h2>
<p>
Basic configuration parameters for a specific plugin can be loaded through the same embedding mechanism the player uses itself.  Plugin parameters are placed inside of the curly braces that follow the plugin name. So if your plugin is called <i>analytics.swf</i>, your variable names will appear like this:
</p>
<pre class="prettyprint lang-html">&lt;script type="text/javascript"&gt;
jwplayer("mediaplayer").setup({
  file: "video.mp4",
  plugins: {
    "analytics.swf": {
       "userid": "12345",
       "events": "play,pause,seek"
    }
  }
});
&lt;/script&gt;
</pre>
<p>
All the flashvars set in HTML that begin with the name of the plugin will be passed to the plugin in the <i>PluginConfig</i> object. For example, this is how the <i>analytics</i> plugin accesses the <i>userid</i> and <i>events</i> properties:
</p>
<pre class="prettyprint">public function initPlugin(ply:IPlayer, cfg:PluginConfig):void {
    var user:String = cfg['userid'];
    var tags:String = cfg['events'];
}
</pre><p>
These property names must be all lowercase characters, the properties will be returned as a string or number.  If you want to pull more complex data into the plugin, it is best to let the plugin itself load the data through an external XML file.  Keep in mind the <a href="http://developer.longtailvideo.com/trac/wiki/FlashSecurity">Crossdomain security restrictions</a> of Flash then: the domain serving the XML needs a <strong>crossdomain.xml</strong> file that must allow access from the domain from which the <strong>player.swf</strong> (NOT the plugin!) is served.
</p>

<h2>Compiling Plugins</h2>

		<p>
This section explains how to compile plugins using the <a class="ext-link" href="http://www.adobe.com/cfusion/entitlement/index.cfm?e=flex3sdk"><span class="icon">Adobe Flex SDK</span></a>. With a combination of this free-for-download tool and a text editor of choice, anyone can build plugins for the JW Player. The Flex SDK is available for Linux, Mac OS X and Windows. The various open-source plugins that we <a href="http://developer.longtailvideo.com/trac/wiki/WikiStart">offer for download</a> can also be modified and re-compiled using this tool.
</p>
<p>
<strong>Note:</strong> If you're looking to develop a plugin in order to serve ads in the JW Player, please <a href="http://www.longtailvideo.com/about/contact-us">contact us</a> beforehand. We have a special SDK for advertisers and advertising networks.
</p>
<h2 id="InstallingtheFlexSDK">Installing the Flex SDK</h2>
<p>
The Flex SDK can be downloaded for free <a class="ext-link" href="http://www.adobe.com/cfusion/entitlement/index.cfm?e=flex3sdk"><span class="icon">from the Adobe site</span></a>. The checkboxes and questions on this page are just for Adobe marketing purposes; they won't change the download. 
</p>
<p>
When the download has been completed, unzip the file and place the <i>flex_sdk_3</i> folder in your folder of choice (e.g. <i>Program Files</i> on Windows or <i>Applications</i> on the MAC). No more installation is needed.
</p>
<h2 id="Compilingaplugin">Compiling a plugin</h2>
<p>
Now let's test-compile a plugin. You can get a few basic plugins by <a class="changeset" href="http://developer.longtailvideo.com/trac/changeset/HEAD/sdks/fl5-plugin-sdk?old_path=/&amp;format=zip" title="- Controlbar background is stretched properly in HTML5 [ticket:1217]
-  ...">downloading the free Plugin SDK</a>. Inside this Plugin SDK, you will find the source code of a few plugins. Each plugin source includes both a <i>build.bat</i> and a <i>build.sh</i> file. The first will compile the plugin on Windows, the latter will compile the plugin on Linux and Mac OS X.
</p>
<p>
To compile plugins, you'll also need <a href="http://developer.longtailvideo.com/trac/export/HEAD/sdks/fl5-plugin-sdk/lib/jwplayer-5-lib.swc">jwplayer-5-lib.swc</a> (the library which contains the Flash Plugin API).  It's included in the plugin SDK, but if you're compiling your plugin without using the SDK, you'll have to download it separately and include it in your MXMLC library path.
</p>
<h3 id="Windows">Windows</h3>
<p>
The <i>build.bat</i> file is used when you run Windows. Open the file in a text editor to check (and possibly change) the path to the Flex SDK on your computer. By default, it is <i>\Program Files\flex_sdk_3</i>. If the path is OK, you can double-click the <i>build.bat</i> file to compile the plugin. That's all!
</p>
<h3 id="LinuxMAC">Linux / MAC</h3>
<p>
The <i>build.sh</i> file is used when you run Linux or Mac OS X. Open the file in a text editor to check (and possibly change) the path to the Flex SDK on your computer. By default, it is <i>/Developer/SDKs/flex_sdk_3</i>. If the path is OK, you can open a Terminal window and insert the full path to the <i>build.sh</i> script to run it. Since sometimes the permissions of this build.sh file are not sufficient to run it, here is an example of what to insert in the terminal window to also set the permissions right:
</p>
<pre class="wiki">cd ~/Desktop/sdks/fl5-plugin-sdk/plugins/player5plugin
chmod 777 build.sh
./build.sh
</pre><p>
That's it! Your plugin will now be built.
</p>
<p>
Note that the compiler will automatically stop and display compilation errors, should there be any in your source code. Use these error messages to find and fix the bugs.
</p>
<h2 id="Compileroptions">Compiler options</h2>
<p>
As you may have seen when opening <i>build.bat</i> or <i>build.sh</i> in the text editor, the actual compilation command is just one line of code:
</p>
<pre class="wiki">%FLEXPATH%\bin\mxmlc .\Positioning.as -sp .\ -o .\positioning.swf -library-path+=.\lib -load-externs .\lib\jwplayer-5-classes.xml  -use-network=false
</pre><p>
This command tells <i>mxmlc</i> (the compiler executive) which actionscript file to compile (<i>Positioning.as</i>). This file is the main class of the plugin. When the plugin is loaded into a player, this main class will be instantiated once. Next to the class to build, the compiler is also given a few options:
</p>
<ul><li><strong>-sp</strong> (shorthand for <strong>-source-path</strong>): tells the compiler what the root directory of the actionscript code to compile is. Though the main actionscript file (<i>Positioning.as</i>) is directly handed  to the compiler, it should know how to resolve additional classes linked from this main class. For example, if the main class imports a <i>com.longtailvideo.jwplayer.plugins.IPlugin</i>, the compiler knows that it can find the actionscript file at <i>.\com\longtailvideo\jwplayer\plugins\IPlugin.as</i>.
</li><li><strong>-o</strong> (shorthand for <strong>-output</strong>): tells the compiler where to write the resulting SWF file. In this case (<i>.\positioning.swf</i>) in the same directory as the build script itself.
</li><li><strong>-library-path</strong>: tells the compiler where to find SWC (library) files, such as the player's API library (jwplayer-5-lib.swc)
</li><li><strong>-load-externs</strong>: instructs the compiler to exclude the classes specified in the provided XML file (jwplayer-5-classes.xml) from the compiled plugin.  This shrinks the size of the compiled plugin, as well as preventing internal player class conflicts.
</li><li><strong>-use-network</strong>: tells the compiler that the SWF either can (<i>true</i>) or cannot (<i>false</i>) access files from the internet when running locally. When  set to <i>true</i>, the SWF cannot load any local files anymore though. Since a lot of people test their plugins locally, we have this option turned <i>false</i>. Note that, if the SWF is served from a webserver, it can still load files from the internet.
</li></ul><p>
The options listed above are sufficient to compile working plugins. The compiler supports a <a class="ext-link" href="http://flexstuff.googlepages.com/FlexCompilerOptions.html"><span class="icon">large number of options</span></a> though, most of them are for more advanced compilation workflows or metadata insertion.
</p>

<h2>Compile and Test</h2>

<h3>Testing</h3>

<p>Tracking what's going on in your ActionScript code can be done in various ways. The professional Flash Builder from Adobe for example, has many options for step debugging and runtime data inspection. Another, quite simple option, is to use the ExternalInterface functionality of Flash to send traces to your browser console:</p>

<pre>
ExternalInterface.call("console.log","This text will appear in the browser console");
</pre>

<p>If you use <a href="http://kb2.adobe.com/cps/142/tn_14266.html">a debug version</span></a> of the Adobe Flash player, any run-time coding errors will display in a popup menu. This is very convenient for tracing down issues.</p>

<h3>Additional Considerations</h3>

<ul>
<li>Since plugins are loaded as external SWFs, you'll need to keep in mind the <a href="crossdomain.html">Crossdomain security restrictions</a>.</li>
<li>Although JW6 is mostly be backwards-compatible with 5.x plugins, a number of plugin features are <a href="5to6.html">no longer supported</a>.</li>
</ul>



</body>
</html>